/*! uppie | (c) 2015 silverwind | BSD license */
!function(e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else{if("function"==typeof define&&define.amd)return define([],e);this.Uppie=e()}}(function(){"use strict";function e(e,n,t){var i=new FormData,r=[],o=function(e,t,f){var c=[];e.forEach(function(e){c.push(new Promise(function(f){if(a in e)e.getFilesAndDirectories().then(function(a){if(n.empty&&!a.length){var c=(t+e.name+"/").replace(/^\//,"");i.append(e.name+"/",new Blob,c),r.push(c)}o(a,e.path+e.name+"/",f)});else{if(e.name){var c=(t+e.name).replace(/^\//,"");i.append(e.name,e,c),r.push(c)}f()}}))}),Promise.all(c).then(f.bind())};e.getFilesAndDirectories().then(function(e){new Promise(function(n){o(e,"/",n)}).then(t.bind(null,i,r))})}function n(e,n,t){var i=new FormData,a=[];[].slice.call(e.files).forEach(function(e){i.append(e.name,e,e.webkitRelativePath),a.push(e.webkitRelativePath)}),t(i,a)}function t(e,n){var t=new FormData,i=[];[].slice.call(e.files).forEach(function(e){t.append(e.name,e,e.name),i.push(e.name)}),n(t,i)}function i(e,n,t){function i(e,n,t,a){var r=n||e.createReader();r.readEntries(function(n){var o=t?t.concat(n):n;n.length?setTimeout(i.bind(null,e,r,o,a),0):a(o)})}function a(e,t,f){t||(t=e.name),i(e,void 0,void 0,function(i){var c=[];i.forEach(function(e){c.push(new Promise(function(n){e.isFile?e.file(function(e){r.append(e.name,e,t+"/"+e.name),o.push(t+"/"+e.name),n()},n.bind()):a(e,t+"/"+e.name,n)}))}),n.empty&&!i.length&&(r.append(e.name+"/",new Blob,t+"/"+e.name+"/"),o.push(t+"/"+e.name+"/")),Promise.all(c).then(f.bind())})}var r=new FormData,o=[],f=[];[].slice.call(e).forEach(function(e){e=e.webkitGetAsEntry(),e&&f.push(new Promise(function(n){e.isFile?e.file(function(e){r.append(e.name,e,e.name),o.push(e.name),n()},n.bind()):e.isDirectory&&a(e,null,n)}))}),Promise.all(f).then(t.bind(null,r,o))}var a="getFilesAndDirectories";return function(r){return function(o,f){if(/^input$/i.test(o.tagName)&&"file"===o.type)o.addEventListener("change",function(i){i.target.files&&i.target.files.length&&(a in i.target?e(i.target,r,f):"webkitRelativePath"in i.target.files[0]?n(i.target,r,f):t(i.target,f))});else{var c=function(e){e.preventDefault()};o.addEventListener("dragover",c),o.addEventListener("dragenter",c),o.addEventListener("drop",function(n){n.preventDefault();var t=n.dataTransfer;a in t?e(t,r,f):t.items&&i(t.items,r,f)})}}}});