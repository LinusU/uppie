/*! uppie | (c) 2015 silverwind | BSD license */
!function(e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else{if("function"==typeof define&&define.amd)return define([],e);this.Uppie=e()}}(function(){"use strict";function e(e,n){var t=new FormData,i=[],r=function(e,n,o){var f=[];e.forEach(function(e){f.push(new Promise(function(o){if(a in e)e.getFilesAndDirectories().then(function(n){r(n,e.path+e.name+"/",o)});else{if(e.name){var f=(n+e.name).replace(/^\//,"");t.append(e.name,e,f),i.push(f)}o()}}))}),Promise.all(f).then(o.bind())};e.getFilesAndDirectories().then(function(e){new Promise(function(n){r(e,"/",n)}).then(n.bind(null,t,i))})}function n(e,n){var t=new FormData,i=[];[].slice.call(e.files).forEach(function(e){t.append(e.name,e,e.webkitRelativePath||e.name),i.push(e.webkitRelativePath||e.name)}),n(t,i)}function t(e,n){var t=new FormData,i=[];[].slice.call(e.files).forEach(function(e){t.append(e.name,e,e.name),i.push(e.name)}),n(t,i)}function i(e,n){function t(e,n,i,a){var r=n||e.createReader();r.readEntries(function(n){var o=i?i.concat(n):n;n.length?setTimeout(t.bind(null,e,r,o,a),0):a(o)})}function i(e,n,o){n||(n=e.name),t(e,void 0,void 0,function(e){var t=[];e.forEach(function(e){t.push(new Promise(function(t){e.isFile?e.file(function(e){a.append(e.name,e,n+"/"+e.name),r.push(n+"/"+e.name),t()},t.bind()):i(e,n+"/"+e.name,t)}))}),Promise.all(t).then(o.bind())})}var a=new FormData,r=[],o=[];[].slice.call(e).forEach(function(e){e=e.webkitGetAsEntry(),e&&o.push(new Promise(function(n){e.isFile?e.file(function(e){a.append(e.name,e,e.name),r.push(e.name),n()},n.bind()):e.isDirectory&&i(e,null,n)}))}),Promise.all(o).then(n.bind(null,a,r))}var a="getFilesAndDirectories";return function(){return function(r,o){if(/^input$/i.test(r.tagName)&&"file"===r.type)r.addEventListener("change",function(i){i.target.files&&i.target.files.length&&(a in i.target?e(i.target,o):"webkitRelativePath"in i.target.files[0]?n(i.target,o):t(i.target,o))});else{var f=function(e){e.preventDefault()};r.addEventListener("dragover",f),r.addEventListener("dragenter",f),r.addEventListener("drop",function(n){n.preventDefault();var t=n.dataTransfer;a in t?e(t,o):t.items&&i(t.items,o)})}}}});